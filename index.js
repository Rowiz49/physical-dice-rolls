/*! For license information please see index.js.LICENSE.txt */
(()=>{"use strict";var t={d:(r,o)=>{for(var a in o)t.o(o,a)&&!t.o(r,a)&&Object.defineProperty(r,a,{enumerable:!0,get:o[a]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r)};function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var h={};define(h,c,(function(){return this}));var y=Object.getPrototypeOf,d=y&&y(y(values([])));d&&d!==r&&o.call(d,c)&&(h=d);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(h);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,h=p.value;return h&&"object"==_typeof(h)&&o.call(h,"__await")?r.resolve(h.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(h).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var h=tryCatch(t,r,o);if("normal"===h.type){if(a=o.done?"completed":"suspendedYield",h.arg===p)continue;return{value:h.arg,done:o.done}}"throw"===h.type&&(a="completed",o.method="throw",o.arg=h.arg)}}}function maybeInvokeDelegate(t,r){var o=r.method,a=t.iterator[o];if(void 0===a)return r.delegate=null,"throw"===o&&t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==o&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+o+"' method")),p;var i=tryCatch(a,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,p;var c=i.arg;return c?c.done?(r[t.resultName]=c.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):c:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(g),define(g,l,"Generator"),define(g,c,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,(i=a.key,c=void 0,c=function _toPrimitive(t,r){if("object"!==_typeof(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var a=o.call(t,r||"default");if("object"!==_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(i,"string"),"symbol"===_typeof(c)?c:String(c)),a)}var i,c}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},_get.apply(this,arguments)}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return function _possibleConstructorReturn(t,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,o)}}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}t.d({},{c:()=>c});var r=function(t){!function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}(RealDiceConfig,FormApplication);var r,o,a=_createSuper(RealDiceConfig);function RealDiceConfig(){return function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,RealDiceConfig),a.call(this)}return function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(RealDiceConfig,[{key:"APP_ID",get:function get(){return this.constructor.APP_ID}},{key:"SETTING_KEY",get:function get(){return this.constructor.SETTING_KEY}},{key:"getData",value:(o=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){return _regeneratorRuntime().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",game.settings.get(c,this.SETTING_KEY));case 1:case"end":return t.stop()}}),_callee,this)}))),function getData(){return o.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(t){var r;_get(_getPrototypeOf(RealDiceConfig.prototype),"activateListeners",this).call(this,t),t=null!==(r=t[0])&&void 0!==r?r:t}},{key:"_updateObject",value:(r=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(t,r){return _regeneratorRuntime().wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:return r=foundry.utils.expandObject(r),t.abrupt("return",game.settings.set(c,this.SETTING_KEY,r));case 2:case"end":return t.stop()}}),_callee2,this)}))),function _updateObject(t,o){return r.apply(this,arguments)})}],[{key:"APP_ID",get:function get(){return this.name.split(/(?=[A-Z])/).join("-").toLowerCase()}},{key:"SETTING_KEY",get:function get(){return this.name.charAt(0).toLowerCase()+this.name.slice(1)}},{key:"defaultOptions",get:function get(){return mergeObject(_get(_getPrototypeOf(RealDiceConfig),"defaultOptions",this),{id:this.APP_ID,template:"modules/".concat(c,"/templates/").concat(this.APP_ID,".hbs"),popOut:!0,minimizable:!0,title:game.i18n.localize("".concat(c,".settings.").concat(this.SETTING_KEY,".name")),closeOnSubmit:!0})}},{key:"register",value:function register(){game.settings.registerMenu(c,this.APP_ID,{name:game.i18n.localize("".concat(c,".settings.").concat(this.SETTING_KEY,".name")),label:game.i18n.localize("".concat(c,".settings.").concat(this.SETTING_KEY,".label")),hint:game.i18n.localize("".concat(c,".settings.").concat(this.SETTING_KEY,".hint")),icon:"fas fa-cogs",type:this,restricted:!0,scope:"world"}),game.settings.register(c,this.SETTING_KEY,{scope:"world",config:!1,default:{d4:!0,d6:!0,d8:!0,d10:!0,d12:!0,d20:!0,d100:!0,other:!1},type:Object})}}]),RealDiceConfig}();function settings_typeof(t){return settings_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},settings_typeof(t)}function settings_regeneratorRuntime(){settings_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var h={};define(h,c,(function(){return this}));var y=Object.getPrototypeOf,d=y&&y(y(values([])));d&&d!==r&&o.call(d,c)&&(h=d);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(h);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,h=p.value;return h&&"object"==settings_typeof(h)&&o.call(h,"__await")?r.resolve(h.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(h).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var h=tryCatch(t,r,o);if("normal"===h.type){if(a=o.done?"completed":"suspendedYield",h.arg===p)continue;return{value:h.arg,done:o.done}}"throw"===h.type&&(a="completed",o.method="throw",o.arg=h.arg)}}}function maybeInvokeDelegate(t,r){var o=r.method,a=t.iterator[o];if(void 0===a)return r.delegate=null,"throw"===o&&t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==o&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+o+"' method")),p;var i=tryCatch(a,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,p;var c=i.arg;return c?c.done?(r[t.resultName]=c.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):c:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(g),define(g,l,"Generator"),define(g,c,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function _slicedToArray(t,r){return function _arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function _iterableToArrayLimit(t,r){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var a,i,c,u,l=[],p=!0,h=!1;try{if(c=(o=o.call(t)).next,0===r){if(Object(o)!==o)return;p=!1}else for(;!(p=(a=c.call(o)).done)&&(l.push(a.value),l.length!==r);p=!0);}catch(t){h=!0,i=t}finally{try{if(!p&&null!=o.return&&(u=o.return(),Object(u)!==u))return}finally{if(h)throw i}}return l}}(t,r)||function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return _arrayLikeToArray(t,r)}(t,r)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function settings_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function registerSettings(){Hooks.on("renderSettingsConfig",(function(t,r,o){colorPicker("messageColor",r),colorPicker("themeColor",r)})),function registerSettingsArray(t){for(var r=0,o=Object.entries(t);r<o.length;r++){var a=_slicedToArray(o[r],2),i=a[0],u=a[1];game.settings.register(c,i,u)}}({gmOnly:{name:"".concat(c,".settings.gmOnly.name"),hint:"".concat(c,".settings.gmOnly.hint"),scope:"world",config:!0,type:Boolean,default:!1},manualRollMode:{name:"".concat(c,".settings.manualRollMode.name"),hint:"".concat(c,".settings.manualRollMode.hint"),scope:"client",config:!1,type:Number,default:0,choices:{0:"".concat(c,".settings.manualRollMode.choices.0"),1:"".concat(c,".settings.manualRollMode.choices.1")},onChange:function onChange(){return updateRealRollMode()}},enableTotalBox:{name:"".concat(c,".settings.enableTotalBox.name"),hint:"".concat(c,".settings.enableTotalBox.hint"),scope:"world",config:!0,type:Boolean,default:!1},showFormula:{name:"".concat(c,".settings.showFormula.name"),hint:"".concat(c,".settings.showFormula.hint"),scope:"world",config:!0,type:Boolean,default:!1},disableInCombat:{name:"".concat(c,".settings.disableInCombat.name"),hint:"".concat(c,".settings.disableInCombat.hint"),scope:"world",config:!0,type:Boolean,default:!1},position:{name:"".concat(c,".settings.position.name"),hint:"".concat(c,".settings.position.hint"),scope:"world",config:!0,type:String,default:"default",choices:{default:"".concat(c,".settings.position.choices.default"),chat:"".concat(c,".settings.position.choices.chat")}},showMessage:{name:"".concat(c,".settings.showMessage.name"),hint:"".concat(c,".settings.showMessage.hint"),scope:"world",config:!0,type:Boolean,default:!0},showMessagePlayers:{name:"".concat(c,".settings.showMessagePlayers.name"),hint:"".concat(c,".settings.showMessagePlayers.hint"),scope:"world",config:!0,type:Boolean,default:!1},messageColor:{name:"".concat(c,".settings.messageColor.name"),hint:"".concat(c,".settings.messageColor.hint"),scope:"world",config:!0,type:String,default:"#ff007a",onChange:function onChange(){return updateColorVar()}},useTheme:{name:"".concat(c,".settings.useTheme.name"),hint:"".concat(c,".settings.useTheme.hint"),scope:"world",config:!0,type:Boolean,default:!0},themeColor:{name:"".concat(c,".settings.themeColor.name"),hint:"".concat(c,".settings.themeColor.hint"),scope:"world",config:!0,type:String,default:"#ffa200",onChange:function onChange(){return updateColorVar()}}}),r.register(),updateColorVar()}function getSetting(t){return game.settings.get(c,t)}function setSetting(t,r){return _setSetting.apply(this,arguments)}function _setSetting(){return _setSetting=function settings_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){settings_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){settings_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}(settings_regeneratorRuntime().mark((function _callee(t,r){return settings_regeneratorRuntime().wrap((function _callee$(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,game.settings.set(c,t,r);case 2:return o.abrupt("return",o.sent);case 3:case"end":return o.stop()}}),_callee)}))),_setSetting.apply(this,arguments)}function colorPicker(t,r){var o=document.createElement("input");o.setAttribute("type","color"),o.setAttribute("data-edit",c+"."+t),o.value=game.settings.get(c,t);var a=r[0].querySelector('input[name="'.concat(c,".").concat(t,'"]'));a.classList.add("color"),a.after(o)}function updateColorVar(){var t=game.settings.get(c,"messageColor");document.documentElement.style.setProperty("--real-roll-message-color",t);var r=game.settings.get(c,"themeColor");document.documentElement.style.setProperty("--real-roll-theme-accent",r)}function app_typeof(t){return app_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},app_typeof(t)}function app_slicedToArray(t,r){return function app_arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function app_iterableToArrayLimit(t,r){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var a,i,c,u,l=[],p=!0,h=!1;try{if(c=(o=o.call(t)).next,0===r){if(Object(o)!==o)return;p=!1}else for(;!(p=(a=c.call(o)).done)&&(l.push(a.value),l.length!==r);p=!0);}catch(t){h=!0,i=t}finally{try{if(!p&&null!=o.return&&(u=o.return(),Object(u)!==u))return}finally{if(h)throw i}}return l}}(t,r)||app_unsupportedIterableToArray(t,r)||function app_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function app_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return app_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?app_arrayLikeToArray(t,r):void 0}}function app_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function app_regeneratorRuntime(){app_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var h={};define(h,c,(function(){return this}));var y=Object.getPrototypeOf,d=y&&y(y(values([])));d&&d!==r&&o.call(d,c)&&(h=d);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(h);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,h=p.value;return h&&"object"==app_typeof(h)&&o.call(h,"__await")?r.resolve(h.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(h).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var h=tryCatch(t,r,o);if("normal"===h.type){if(a=o.done?"completed":"suspendedYield",h.arg===p)continue;return{value:h.arg,done:o.done}}"throw"===h.type&&(a="completed",o.method="throw",o.arg=h.arg)}}}function maybeInvokeDelegate(t,r){var o=r.method,a=t.iterator[o];if(void 0===a)return r.delegate=null,"throw"===o&&t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==o&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+o+"' method")),p;var i=tryCatch(a,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,p;var c=i.arg;return c?c.done?(r[t.resultName]=c.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):c:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(g),define(g,l,"Generator"),define(g,c,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function app_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function app_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){app_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){app_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function app_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,(i=a.key,c=void 0,c=function app_toPrimitive(t,r){if("object"!==app_typeof(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var a=o.call(t,r||"default");if("object"!==app_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(i,"string"),"symbol"===app_typeof(c)?c:String(c)),a)}var i,c}function app_get(){return app_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=function app_superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=app_getPrototypeOf(t)););return t}(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},app_get.apply(this,arguments)}function app_setPrototypeOf(t,r){return app_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},app_setPrototypeOf(t,r)}function app_createSuper(t){var r=function app_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=app_getPrototypeOf(t);if(r){var i=app_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return function app_possibleConstructorReturn(t,r){if(r&&("object"===app_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function app_assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,o)}}function app_getPrototypeOf(t){return app_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},app_getPrototypeOf(t)}var o={2:"../modules/real-dice/assets/two-coins.svg",4:"../icons/svg/d4-grey.svg",6:"../icons/svg/d6-grey.svg",8:"../icons/svg/d8-grey.svg",10:"../icons/svg/d10-grey.svg",12:"../icons/svg/d12-grey.svg",20:"../icons/svg/d20-grey.svg",default:"../icons/svg/d6-grey.svg"},a=function(t){!function app_inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&app_setPrototypeOf(t,r)}(RealRoll,FormApplication);var a,i,u,l,p,h,y,d=app_createSuper(RealRoll);function RealRoll(t,r){var a;return function app_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,RealRoll),(a=d.call(this)).dieTerms=t,a.roll=r,a.dieTerms.forEach((function(t){var r,i;t.exploding=(null!==(r=t.modifiers)&&void 0!==r?r:[]).includes("x"),t.inputs=Array.from({length:t.number},(function(){return t.faces})),t._processing=!0,t._image=null!==(i=o[t.faces])&&void 0!==i?i:o.default,t.number>1&&getSetting("enableTotalBox")&&(t.totalInput={min:t.number,max:t.number*t.faces}),t.index=a.dieTerms.indexOf(t)})),a.promise=new Promise((function(t,r){a._resolve=t,a._reject=r})),a}return function app_createClass(t,r,o){return r&&app_defineProperties(t.prototype,r),o&&app_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(RealRoll,[{key:"prompt",value:(y=app_asyncToGenerator(app_regeneratorRuntime().mark((function _callee(){return app_regeneratorRuntime().wrap((function _callee$(t){for(;;)switch(t.prev=t.next){case 0:if(2!==getSetting("manualRollMode")){t.next=7;break}return t.next=3,this.askForManual();case 3:if(t.sent){t.next=7;break}return this._resolve(!0),t.abrupt("return",this.promise);case 7:return t.next=9,this.render(!0);case 9:return t.abrupt("return",this.promise);case 10:case"end":return t.stop()}}),_callee,this)}))),function prompt(){return y.apply(this,arguments)})},{key:"askForManual",value:(h=app_asyncToGenerator(app_regeneratorRuntime().mark((function _callee2(){var t;return app_regeneratorRuntime().wrap((function _callee2$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,new Promise((function(t,r){return setTimeout(t,200)}));case 2:return r.next=4,Dialog.confirm({title:"Manual Roll",content:"Would you like to roll manually?",yes:function yes(){return!0},no:function no(){return!1},defaultYes:!1,close:function close(){return!1}});case 4:return t=r.sent,r.abrupt("return",t);case 6:case"end":return r.stop()}}),_callee2)}))),function askForManual(){return h.apply(this,arguments)})},{key:"id",get:function get(){return RealRoll.APP_ID+randomID()}},{key:"getData",value:(p=app_asyncToGenerator(app_regeneratorRuntime().mark((function _callee3(){return app_regeneratorRuntime().wrap((function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",{rollFormula:getSetting("showFormula")?this.roll.formula:null,dieTerms:this.dieTerms,multiRow:this.dieTerms.length>1});case 1:case"end":return t.stop()}}),_callee3,this)}))),function getData(){return p.apply(this,arguments)})},{key:"activateListeners",value:function activateListeners(t){var r;if(app_get(app_getPrototypeOf(RealRoll.prototype),"activateListeners",this).call(this,t),t=null!==(r=t[0])&&void 0!==r?r:t,"chat"==getSetting("position")){var o=document.getElementById("chat-log").getBoundingClientRect(),a=o.left-Math.max(200,this.element[0].offsetWidth)-10,i=o.top+o.height-this.element[0].offsetHeight/2;this.setPosition({left:a,top:i})}t.querySelector("input").focus()}},{key:"_updateObject",value:(l=app_asyncToGenerator(app_regeneratorRuntime().mark((function _callee4(t,r){var o,a,i,c,u,l,p,h,y,d,g,v,m,_,b,w,x,P,k,E,O=this;return app_regeneratorRuntime().wrap((function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:o=foundry.utils.expandObject(r),a=0,i=Object.entries(o);case 2:if(!(a<i.length)){t.next=20;break}if(c=app_slicedToArray(i[a],2),u=c[0],(l=c[1]).total){t.next=6;break}return t.abrupt("continue",17);case 6:if(p=this.dieTerms[parseInt(u)]){t.next=9;break}return t.abrupt("continue",17);case 9:for(h=parseInt(l.total),y=p.number,d=p.faces,g=[],v=h,m=0;m<y;m++)_=Math.max(1,v-(y-m-1)*d),b=Math.min(d,v-(y-m-1)),w=Math.floor(Math.random()*(b-_+1))+_,g.push(w),v-=w;for(delete l.total,x=0;x<y;x++)l[x]=g[x];case 17:a++,t.next=2;break;case 20:P=!1,k=app_regeneratorRuntime().mark((function _loop(){var t,r,a;return app_regeneratorRuntime().wrap((function _loop$(i){for(;;)switch(i.prev=i.next){case 0:if(t=O.dieTerms[E],r=o["".concat(E)]){i.next=4;break}return i.abrupt("return","continue");case 4:t.inputs=t.inputs.map((function(t,o){var a;return null!==(a=r["".concat(o)])&&void 0!==a?a:null})),t.inputs.some((function(t){return null!==t}))&&(P=!0),a=function rollOverride(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=r.minimize,a=void 0!==o&&o,i=r.maximize,c=void 0!==i&&i,u={result:void 0,active:!0};return u.result=a?Math.min(1,this.faces):c?this.faces:null!==(t=this.inputs[this.results.length])&&void 0!==t?t:Math.ceil(CONFIG.Dice.randomUniform()*this.faces),this.results.push(u),u},t.roll=a.bind(t);case 8:case"end":return i.stop()}}),_loop)})),E=0;case 23:if(!(E<this.dieTerms.length)){t.next=31;break}return t.delegateYield(k(),"t0",25);case 25:if("continue"!==t.t0){t.next=28;break}return t.abrupt("continue",28);case 28:E++,t.next=23;break;case 31:P&&this.displayGmMessage();case 32:case"end":return t.stop()}}),_callee4,this)}))),function _updateObject(t,r){return l.apply(this,arguments)})},{key:"displayGmMessage",value:(u=app_asyncToGenerator(app_regeneratorRuntime().mark((function _callee5(){return app_regeneratorRuntime().wrap((function _callee5$(t){for(;;)switch(t.prev=t.next){case 0:if((!game.user.isGM||getSetting("showMessagePlayers"))&&getSetting("showMessage")){t.next=2;break}return t.abrupt("return");case 2:ChatMessage.create({content:'<div class="real-roll-message">'.concat(game.user.name," ").concat(game.i18n.localize("".concat(c,".").concat(RealRoll.APP_ID,".realRollMessage")),"</div>"),speaker:{alias:"Real Dice"},whisper:getSetting("showMessagePlayers")?null:ChatMessage.getWhisperRecipients("GM")});case 3:case"end":return t.stop()}}),_callee5)}))),function displayGmMessage(){return u.apply(this,arguments)})},{key:"close",value:(i=app_asyncToGenerator(app_regeneratorRuntime().mark((function _callee6(){var t,r,o,a,i=arguments;return app_regeneratorRuntime().wrap((function _callee6$(c){for(;;)switch(c.prev=c.next){case 0:for(this._resolve(!0),r=i.length,o=new Array(r),a=0;a<r;a++)o[a]=i[a];return c.abrupt("return",(t=app_get(app_getPrototypeOf(RealRoll.prototype),"close",this)).call.apply(t,[this].concat(o)));case 3:case"end":return c.stop()}}),_callee6,this)}))),function close(){return i.apply(this,arguments)})}],[{key:"prompt",value:(a=app_asyncToGenerator(app_regeneratorRuntime().mark((function _callee7(t,r){var o,a,i,c,u;return app_regeneratorRuntime().wrap((function _callee7$(l){for(;;)switch(l.prev=l.next){case 0:if(l.prev=0,(null!==(o=null===(a=r.options)||void 0===a?void 0:a.rollMode)&&void 0!==o?o:game.settings.get("core","rollMode"))!=CONST.DICE_ROLL_MODES.BLIND){l.next=4;break}return l.abrupt("return",!0);case 4:if(null===(i=game.combat)||void 0===i||!i.started||!getSetting("disableInCombat")){l.next=6;break}return l.abrupt("return",!0);case 6:if((c=this.getTermsRecursive(t)).length&&0!=getSetting("manualRollMode")){l.next=9;break}return l.abrupt("return",!0);case 9:return u=new RealRoll(c,r),l.abrupt("return",u.prompt());case 13:return l.prev=13,l.t0=l.catch(0),l.abrupt("return",!0);case 16:case"end":return l.stop()}}),_callee7,this,[[0,13]])}))),function prompt(t,r){return a.apply(this,arguments)})},{key:"getTermsRecursive",value:function getTermsRecursive(t){var o=[];!function traverse(t){if(t){var r,a=function _createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=app_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,l=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return u=t.done,t},e:function e(t){l=!0,c=t},f:function f(){try{u||null==o.return||o.return()}finally{if(l)throw c}}}}(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;i instanceof Die&&!i._processing&&o.push(i),"dice"in i&&traverse(i.dice)}}catch(t){a.e(t)}finally{a.f()}}}(t);var a=getSetting(r.SETTING_KEY);return o.filter((function(t){var r;return null!==(r=a["d".concat(t.faces)])&&void 0!==r?r:a.other}))}},{key:"APP_ID",get:function get(){return"real-roll"}},{key:"defaultOptions",get:function get(){return mergeObject(app_get(app_getPrototypeOf(RealRoll),"defaultOptions",this),{id:this.APP_ID,template:"modules/".concat(c,"/templates/").concat(this.APP_ID,".hbs"),popOut:!0,resizable:!1,minimizable:!0,title:game.i18n.localize("".concat(c,".").concat(this.APP_ID,".title")),classes:getSetting("useTheme")?["themed-mode",this.APP_ID]:[this.APP_ID]})}}]),RealRoll}();function evaluateRoll_typeof(t){return evaluateRoll_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},evaluateRoll_typeof(t)}function evaluateRoll_regeneratorRuntime(){evaluateRoll_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var c=r&&r.prototype instanceof Generator?r:Generator,u=Object.create(c.prototype),l=new Context(i||[]);return a(u,"_invoke",{value:makeInvokeMethod(t,o,l)}),u}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var h={};define(h,c,(function(){return this}));var y=Object.getPrototypeOf,d=y&&y(y(values([])));d&&d!==r&&o.call(d,c)&&(h=d);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(h);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,c,u){var l=tryCatch(t[a],t,i);if("throw"!==l.type){var p=l.arg,h=p.value;return h&&"object"==evaluateRoll_typeof(h)&&o.call(h,"__await")?r.resolve(h.__await).then((function(t){invoke("next",t,c,u)}),(function(t){invoke("throw",t,c,u)})):r.resolve(h).then((function(t){p.value=t,c(p)}),(function(t){return invoke("throw",t,c,u)}))}u(l.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,c){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw c;return doneResult()}for(o.method=i,o.arg=c;;){var u=o.delegate;if(u){var l=maybeInvokeDelegate(u,o);if(l){if(l===p)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var h=tryCatch(t,r,o);if("normal"===h.type){if(a=o.done?"completed":"suspendedYield",h.arg===p)continue;return{value:h.arg,done:o.done}}"throw"===h.type&&(a="completed",o.method="throw",o.arg=h.arg)}}}function maybeInvokeDelegate(t,r){var o=r.method,a=t.iterator[o];if(void 0===a)return r.delegate=null,"throw"===o&&t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==o&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+o+"' method")),p;var i=tryCatch(a,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,p;var c=i.arg;return c?c.done?(r[t.resultName]=c.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):c:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[c];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,l,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,u,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,c){void 0===c&&(c=Promise);var u=new AsyncIterator(wrap(r,o,a,i),c);return t.isGeneratorFunction(o)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},defineIteratorMethods(g),define(g,l,"Generator"),define(g,c,(function(){return this})),define(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return c.type="throw",c.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var c=i;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=r&&r<=c.finallyLoc&&(c=null);var u=c?c.completion:{};return u.type=t,u.arg=r,c?(this.method="next",this.next=c.finallyLoc,p):this.complete(u)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function evaluateRoll_asyncGeneratorStep(t,r,o,a,i,c,u){try{var l=t[c](u),p=l.value}catch(t){return void o(t)}l.done?r(p):Promise.resolve(p).then(a,i)}function _evaluate(t){return _evaluate2.apply(this,arguments)}function _evaluate2(){return _evaluate2=function evaluateRoll_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var c=t.apply(r,o);function _next(t){evaluateRoll_asyncGeneratorStep(c,a,i,_next,_throw,"next",t)}function _throw(t){evaluateRoll_asyncGeneratorStep(c,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}(evaluateRoll_regeneratorRuntime().mark((function _callee(t){var r,o,i,c=arguments;return evaluateRoll_regeneratorRuntime().wrap((function _callee$(u){for(;;)switch(u.prev=u.next){case 0:if(0==getSetting("manualRollMode")){u.next=3;break}return u.next=3,a.prompt(this.terms,this);case 3:for(r=c.length,o=new Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=c[i];return u.abrupt("return",t.apply(void 0,o));case 5:case"end":return u.stop()}}),_callee,this)}))),_evaluate2.apply(this,arguments)}var i={0:"fas fa-square-xmark",1:"fas fa-dice"};function initConfig(){!function registerKeyBindings(){game.keybindings.register(c,"toggleRollMode",{name:"".concat(c,".keybindings.toggleRollMode.name"),editable:[{key:"KeyR",modifiers:[KeyboardManager.MODIFIER_KEYS.SHIFT]}],restricted:!1,onDown:function onDown(){},onUp:function onUp(){setSetting("manualRollMode",(getSetting("manualRollMode")+1)%2)}})}(),libWrapper.register(c,"Roll.prototype._evaluate",_evaluate,"WRAPPER"),Hooks.on("renderSidebarTab",(function(t,r,o){if("chat"===t.tabName&&(!getSetting("gmOnly")||game.user.isGM)){if(!r[0].querySelector(".control-buttons")){var a=document.createElement("div");a.classList.add("control-buttons"),a.style.maxWidth="25px",r[0].querySelector(".roll-type-select").after(a)}var i=document.createElement("a");i.setAttribute("role","button"),i.setAttribute("tooltip-direction","UP"),i.classList.add("real-roll-mode-toggle"),updateRealRollMode(i),i.addEventListener("click",(function(){setSetting("manualRollMode",(getSetting("manualRollMode")+1)%2)})),r[0].querySelector(".control-buttons").prepend(i)}})),Hooks.on("renderModuleManagement",(function(t,r,o){getSetting("gmOnly")&&!game.user.isGM&&r[0].querySelectorAll('[data-module-id="real-dice"]').forEach((function(t){t.style.display="none"}))}))}function updateRealRollMode(t){if(t){var r=getSetting("manualRollMode"),o=game.i18n.localize("".concat(c,".buttons.realRollToggle.tooltips.").concat(r));t.setAttribute("data-tooltip",o),t.setAttribute("aria-label",o),t.innerHTML='<i class="'.concat(i[r],'"></i>')}else{document.querySelectorAll(".real-roll-mode-toggle").forEach((function(t){return updateRealRollMode(t)}))}}var c="real-dice",u=document.createElement("style");u.appendChild(document.createTextNode("\n.chat-message:has(.real-roll-message){\n    display: none;\n}")),document.head.appendChild(u),Hooks.on("init",(function(){registerSettings()})),Hooks.on("setup",(function(){initConfig(),CONFIG.Dice.RealRoll=a})),Hooks.on("ready",(function(){(game.user.isGM||getSetting("showMessagePlayers"))&&document.head.removeChild(u),!game.user.isGM&&getSetting("gmOnly")&&(libWrapper.unregister_all(c),game.keybindings.actions.get("".concat(c,".toggleRollMode")).restricted=!0)}))})();
//# sourceMappingURL=index.js.map